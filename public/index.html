<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Thailand Map Data Visualisation</title>

    <!--<script src="https://d3js.org/d3.v6.min.js"></script> -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v3.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
    <script src="js/map.js"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <style>
        #map {
            width: 960px;
            height: 700px;
        }
    </style>
</head>
<body>

<div id="map"></div>

<svg></svg>

<h2>Welcome</h2>


<script>
console.log(d3)

let width = 960,
    height = 700,
    centered;


// Promise format does not work with d3 version 3
Promise.all([
    d3.json("thailand.json"),
    d3.csv("coordinatesJan28.csv")
]).then( ([mapData ,coordinates]) => {
    createMap(mapData, coordinates)
})

var map = new L.Map("map", {center: [13.7, 100.5], zoom: 5})
    .addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"));

var svg = d3.select(map.getPanes().overlayPane).append("svg"),
    g = svg.append("g").attr("class", "leaflet-zoom-hide");

d3.json("thailand.json", function(error, collection) {
    if(error) throw error;

    var transform = d3.geo.transform({point: projectPoint}),
        path = d3.geo.path().projection(transform);

    var feature = g.selectAll("path")
        .data(collection.features)
        .enter().append("path");

    map.on("viewreset", reset);
    reset();

    function reset() {
        var bounds = path.bounds(collection),
            topLeft = bounds[0],
            bottomRight = bounds[1];

        svg .attr("width", bottomRight[0] - topLeft[0])
            .attr("height", bottomRight[1] - topLeft[1])
            .style("left", topLeft[0] + "px")
            .style("top", topLeft[1] + "px")
            .attr("d", function(d) { return path(d) })
            .attr("stroke-width", 2)
            .attr("stroke", "blue")
            .attr("fill", d => "transparent");;

        g   .attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");

        feature.attr("d", path);
    }


    function projectPoint(x, y) {
        var point = map.latLngToLayerPoint(new L.LatLng(y, x));
        this.stream.point(point.x, point.y);
    }

});


function createMap(mapData, coordinates) {



    console.log(mapData)
    console.log(coordinates)

    /*var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    var g = svg.append('g');
    var mapLayer = g.append('g')
        .classed('map-layer', true);

    var circleLayer = g.append('g')
        .classed('circle-layer', true);

    let proj = d3.geoMercator()
        .translate([250, 250])
        .scale(2000)
        .rotate([-100.6331, -13.2])

    let path = d3.geoPath()
        .projection(proj)

    mapLayer.selectAll("path")
        .data(mapData.features)
        .enter()
        .append("path")
            .attr("d", function(d) { return path(d) })
            .attr("stroke-width", 2)
            .attr("stroke", "#ffffff")
            .attr("fill", d => "blue");

*/
         /*THIS PUTS THE DOTS ON THE MAP
     circleLayer.selectAll("circle")
         .data(coordinates)
         .enter()
         .append("circle")
             .attr("r", 3)
             .attr("cx", d => proj([+d.longitude, +d.latitude])[0])
             .attr("cy", d => proj([+d.longitude, +d.latitude])[1])
             .attr("stroke-width", 1)
             .attr("stroke", "#4F442B")
             .attr("fill", function() { return "#FFD061" });

*/

//    d3.csv("coordinates.csv", function(fireData) {
//        console.log(fireData)
//        console.log(proj([mapData.latitude, mapData.longitude]))
//        console.log(proj([fireData[0].latitude, fireData[0].longitude]))
//        mapLayer.selectAll("path")
//            .data(fireData)
//            .enter()
//            .append("circle")
//                .attr("r", 3)
//                .attr("cx", d => proj([d.latitude, d.longitude])[0])
//                .attr("cy", d => proj([d.latitude, d.longitude])[1])
//                .attr("stroke-width", 1)
//                .attr("stroke", "#4F442B")
//                .attr("fill", function() { return "#FFD061" });
//    });

    // d3.select("svg")
    //     .selectAll("path")
    //     .data(mapData.features)
    //     .enter()
    //     .append("path")
    //         .attr("d", path)
    //         .attr("d", function(d) { return path(d) })
    //         .attr("stroke-width", 1)
    //         .attr("stroke", "#ffffff")
    //         .style("fill", function() { return "#FFD061" });

}




</script>

</body>
</html>
