<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Thailand Map Data Visualisation</title>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <!-- <script src="https://d3js.org/d3.v3.min.js"></script> -->
    <script src="https://d3js.org/d3-geo-projection.v3.min.js"></script>
    <!-- ******** is this allowed to get rid of and steal it -->
<!--    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"-->
<!--          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="-->
<!--          crossorigin=""/>-->
    <link rel="stylesheet" href="leafletstyle.css">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
    <script src="js/map.js"></script>
    <!--<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />-->
    <style>
        #map {
            width: 960px;
            height: 700px;
        }
    </style>
</head>
<body>

 <div id="map"></div>

<svg></svg>

<h2>Welcome</h2>


<script>
    console.log(d3)

    let width = 960,
        height = 700,
        centered;


    // Promise format does not work with d3 version 3
    Promise.all([
        d3.json("thailand.json",
            console.log("This is the callback function"),
            console.log("callback2")
        ),
        d3.csv("coordinatesJan28.csv")
    ]).then( ([mapData ,coordinates]) => {
        coordBox(coordinates),
        createMap(mapData, coordinates),
            test(mapData, coordinates),
            callback()

    })


    function coordBox(coordinates) {

        console.log("min in a something: " + d3.min(coordinates, function(d) { return parseFloat(d.latitude); }));

        var minLatSoFar = coordinates[0].latitude,
            maxLatSoFar = coordinates[0].latitude,
            minLongSoFar = coordinates[0].longitude,
            maxLongSoFar = coordinates[0].longitude;

        console.log("first one " + minLatSoFar);

        var i;
        for(i = 0; i < coordinates.length; i++) {
            if(parseInt(coordinates[i].latitude) < minLatSoFar) {
                console.log("i: " + i + ": " + minLatSoFar);
                minLatSoFar = coordinates[i].latitude;
                console.log("i2: " + i + ": " + minLatSoFar);
            }
            if(parseInt(coordinates[i].latitude) > maxLatSoFar) {
                maxLatSoFar = coordinates[i].latitude;
            }
            if(parseInt(coordinates[i].longitude) < minLongSoFar) {
                minLongSoFar = coordinates[i].longitude;
            }
            if(parseInt(coordinates[i].longitude) > maxLongSoFar) {
                maxLongSoFar = coordinates[i].longitude;
            }
        }

        console.log("minLat " + minLatSoFar); // -0.824
        console.log("maxLat " + maxLatSoFar); // 9.558
        console.log("minLong " + minLongSoFar); // 100.039
        console.log("maxLong " + maxLongSoFar); // 99.995
    }

    function callback() {
        console.log("This is the callback function");
    }

    function test(mapData, coordinates) {

        var map = new L.Map("map", {center: [13.7, 100.5], zoom: 5, minZoom: 4})
            .addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"));

        // Finds the overlayPane div and places 2 svgs inside. The second has a class name of "circle-layer"
        // There is also a g div in the first svg with a name of "leaflet-zoom-hide"
        var svg = d3.select(map.getPanes().overlayPane).append("svg"),
            g = svg.append("g").attr("class", "leaflet-zoom-hide"),
            svg1 = d3.select(map.getPanes().overlayPane).append("svg").attr("class", "circle-layer"),
            g1 = svg1.append("g").attr("class", "inner-CL");

        // This takes the path and fits the projection on it using the function below
        var transform = d3.geoTransform({point: projectPoint}),
            path = d3.geoPath().projection(transform);

        var feature = g.selectAll("path")
            .data(mapData.features)
            .enter().append("path");

        // Creates all the circle elements in the circle-layer div
        g1.selectAll("circle")
            .data(coordinates)
            .enter().append("circle");

        // Selector. Selects all the circle elements in the circle-layer div
        const allCircles = document.querySelectorAll(".inner-CL > circle");
        //allCircles[0].classList.add("class" + 1);
        console.log("next is selector");

        // Sets all the attributes for each circle element
        for(var i = 0; i < coordinates.length; i++) {
            if(coordinates[i].latitude > 5 && coordinates[i].latitude < 20) {
                if (coordinates[i].longitude > 98 && coordinates[i].longitude < 105) {
                    allCircles[i].classList.add("class" + i);
                    allCircles[i].setAttribute("r", 3)
                    allCircles[i].setAttribute("stroke-width", 1);
                    allCircles[i].setAttribute("stroke", "#4F442B");
                    allCircles[i].setAttribute("fill", "#FFD061");
                    allCircles[i].setAttribute("cx", map.latLngToLayerPoint(new L.LatLng(coordinates[i].latitude, coordinates[i].longitude)).x);
                    allCircles[i].setAttribute("cy", map.latLngToLayerPoint(new L.LatLng(coordinates[i].latitude, coordinates[i].longitude)).y);
                }
            }
        }

        // TODO when you zoom in too much this isnt big enought. Need to calculate and update.
        svg1.attr("width", 2000)
        .attr("height", 2000)
        .attr("pointer-events", "none");


        // The following code adds a boundary box around all the dots in d3
        /*
        var minLatSoFar = coordinates[0].latitude,
            maxLatSoFar = coordinates[0].latitude,
            minLongSoFar = coordinates[0].longitude,
            maxLongSoFar = coordinates[0].longitude;

        var i;
        for(i = 0; i < coordinates.length; i++) {
            if(parseInt(coordinates[i].latitude) < minLatSoFar) {
                minLatSoFar = coordinates[i].latitude;
            }
            if(parseInt(coordinates[i].latitude) > maxLatSoFar) {
                maxLatSoFar = coordinates[i].latitude;
            }
            if(parseInt(coordinates[i].longitude) < minLongSoFar) {
                minLongSoFar = coordinates[i].longitude;
            }
            if(parseInt(coordinates[i].longitude) > maxLongSoFar) {
                maxLongSoFar = coordinates[i].longitude;
            }
        }

        var latlngs = [[parseFloat(minLatSoFar), parseFloat(minLongSoFar)],
            [parseFloat(maxLatSoFar), parseFloat(minLongSoFar)],
            [parseFloat(maxLatSoFar), parseFloat(maxLongSoFar)],
            [parseFloat(minLatSoFar), parseFloat(maxLongSoFar)]];

        var polygon = L.polygon(latlngs, {color: 'red'}).addTo(map);
        */

        var states = [{
            "type": "Feature",
            "properties": {"party": "Republican"},
            "geometry": {
                "type": "Polygon",
                "coordinates": [[
                    [-104.05, 48.99],
                    [-97.22,  48.98],
                    [-96.58,  45.94],
                    [-104.03, 45.94],
                    [-104.05, 48.99]
                ]]
            }
        }, { "type": "Feature", "properties": { "name": "Mae Hong Son" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 98.085929810000096, 19.773161112000082 ], [ 98.111354615000096, 19.777140198000069 ], [ 98.132231893000039, 19.766055603000069 ], [ 98.172022746000096, 19.731561584000104 ], [ 98.205922485000087, 19.721484681000049 ], [ 98.213260539000089, 19.71776397800005 ], [ 98.217911418000028, 19.707971293000071 ], [ 98.216671183000074, 19.687455750000112 ], [ 98.21915165200005, 19.676991272000066 ], [ 98.237548462000063, 19.664692281000043 ], [ 98.262766562000138, 19.669859924000036 ], [ 98.307311645000027, 19.689987895000087 ], [ 98.34761926300007, 19.690633851000086 ], [ 98.394438111000113, 19.686344706000114 ], [ 98.439603312000088, 19.687739970000081 ], [ 98.474536580000063, 19.705309957000054 ], [ 98.477800686026512, 19.705629272236536 ], [ 98.476191033589316, 19.693707791081664 ], [ 98.479343295856438, 19.673295599812064 ], [ 98.482598911810328, 19.664097195429264 ], [ 98.490660434631366, 19.653115953438515 ], [ 98.499342075976017, 19.644201768097076 ], [ 98.500789015900352, 19.642987372169529 ], [ 98.503062779023992, 19.641540432245108 ], [ 98.512881301031257, 19.632445379750408 ], [ 98.520942823852181, 19.62639923853402 ], [ 98.545282423744823, 19.61291168942293 ], [ 98.547762893342792, 19.61063792629929 ], [ 98.549984978723728, 19.608209133544648 ], [ 98.55122521397243, 19.604669298549283 ], [ 98.553085565046729, 19.580148831503408 ], [ 98.554739211445394, 19.572449042089602 ], [ 98.559596796055303, 19.558754788302849 ], [ 98.561147088767086, 19.555912584398271 ], [ 98.563110792628947, 19.553432114800188 ], [ 98.571068963561856, 19.546688340694374 ], [ 98.573239373897934, 19.544311224783229 ], [ 98.574944696240721, 19.541598212087848 ], [ 98.575719842596641, 19.537955024304921 ], [ 98.576184929690726, 19.51782705297606 ], [ 98.576960076945966, 19.514054673984049 ], [ 98.578820428020322, 19.510979926082683 ], [ 98.581300896719029, 19.508576971749847 ], [ 98.588122186090004, 19.505605577535334 ], [ 98.593496534637325, 19.502324124059015 ], [ 98.600679559214257, 19.494727688332148 ], [ 98.604090203899773, 19.489146633310469 ], [ 98.607242466166895, 19.482583726357831 ], [ 98.608275994941209, 19.478992214519053 ], [ 98.608275994941209, 19.473488673863216 ], [ 98.606932407804379, 19.466383165450736 ], [ 98.602384881556986, 19.45085439721268 ], [ 98.600369500851798, 19.438762112081776 ], [ 98.59974938412671, 19.420106919998318 ], [ 98.600679559214257, 19.411528632340492 ], [ 98.600214471220909, 19.404500637394506 ], [ 98.598767531296573, 19.399694728728718 ], [ 98.595046828248485, 19.394372057024782 ], [ 98.592928093856415, 19.389307765940714 ], [ 98.59246300676233, 19.383390815034119 ], [ 98.594633417098464, 19.373236396242703 ], [ 98.597268915428117, 19.368146266736829 ], [ 98.599904412858336, 19.364477240532182 ], [ 98.602384881556986, 19.362255154251955 ], [ 98.604245232631399, 19.359490464713161 ], [ 98.605485467880044, 19.355149644040807 ], [ 98.60600223181757, 19.349310208399373 ], [ 98.605795526242503, 19.339646715123763 ], [ 98.60755252542873, 19.329285589858102 ], [ 98.609826287652993, 19.322154242124611 ], [ 98.610653110852411, 19.314066880881853 ], [ 98.610343051590519, 19.295566718429313 ], [ 98.611273227577328, 19.285644842735309 ], [ 98.610136346015565, 19.276239731878064 ], [ 98.598354120146553, 19.23210805923955 ], [ 98.589672478801788, 19.211618354503457 ], [ 98.588742302814978, 19.208130195452185 ], [ 98.588897333345244, 19.203970241933092 ], [ 98.59153283077552, 19.198234158179872 ], [ 98.59401330037349, 19.194823513494356 ], [ 98.596648797803766, 19.191903795223908 ], [ 98.617267693749056, 19.174953925483265 ], [ 98.624450718325932, 19.16756419533138 ], [ 98.649565463675174, 19.127437446580842 ], [ 98.650650669292929, 19.124104316261196 ], [ 98.654991489965255, 19.101030789139628 ], [ 98.65127078691728, 19.083279933721997 ], [ 98.644604527177137, 19.066924343183899 ], [ 98.640418736135757, 19.059560452352997 ], [ 98.636698033087782, 19.055219630781295 ], [ 98.622435336721423, 19.045737006457671 ], [ 98.616234164974742, 19.04279144886624 ], [ 98.612926873975994, 19.041783759413022 ], [ 98.604555291893234, 19.040233465801833 ], [ 98.587295362890643, 19.039303289814939 ], [ 98.58347130705522, 19.038476467514982 ], [ 98.57354943226045, 19.034807441310335 ], [ 98.560837030404571, 19.028218695936062 ], [ 98.557426384819792, 19.026952623165016 ], [ 98.553498977096126, 19.025919094390702 ], [ 98.545592483006715, 19.024523831309722 ], [ 98.541406691065902, 19.024678860041348 ], [ 98.533345168244921, 19.025919094390702 ], [ 98.503992955010801, 19.034988308463682 ], [ 98.491590610618175, 19.037442938740668 ], [ 98.487249789945849, 19.037520453106453 ], [ 98.483529086897875, 19.036977850747235 ], [ 98.480273471843248, 19.035737616397881 ], [ 98.477637974412971, 19.033748074114328 ], [ 98.475467564076837, 19.031396795725556 ], [ 98.465080601288662, 19.010597031727627 ], [ 98.461049838978852, 19.00772899030062 ], [ 98.457587518349271, 19.007263902307244 ], [ 98.454693637601281, 19.008969225549322 ], [ 98.444151646081536, 19.017263292367034 ], [ 98.434488152806011, 19.022069200133444 ], [ 98.420070427708026, 19.026616726380752 ], [ 98.403947382066065, 19.029872341435464 ], [ 98.386377394700958, 19.031422634147248 ], [ 98.355061476705828, 19.02976898954725 ], [ 98.346844924253787, 19.030776679000468 ], [ 98.343124221205812, 19.031810207774839 ], [ 98.336561314253288, 19.034884954776828 ], [ 98.333977491867699, 19.036667792384691 ], [ 98.328706496107941, 19.041266995475411 ], [ 98.326639438559255, 19.043876655383315 ], [ 98.321988560423677, 19.052920030135311 ], [ 98.318112827744756, 19.058475246735185 ], [ 98.306640660238259, 19.070619207810154 ], [ 98.303230014653423, 19.076458645250312 ], [ 98.299044223612043, 19.081729641010099 ], [ 98.294238315845575, 19.086328844100905 ], [ 98.280234002796931, 19.095527249383082 ], [ 98.277650181310833, 19.097594306032391 ], [ 98.275169711712863, 19.100178128417866 ], [ 98.27310265506344, 19.102916977736328 ], [ 98.263335809000409, 19.125112005714499 ], [ 98.261010369932592, 19.12787669525332 ], [ 98.247367792089904, 19.141829332357759 ], [ 98.242096796330031, 19.146144313709101 ], [ 98.238686150745252, 19.147797960107738 ], [ 98.235275506959113, 19.148960680091335 ], [ 98.226697219301172, 19.150097560753835 ], [ 98.223286573716393, 19.151415310368236 ], [ 98.220392693867666, 19.153198147076807 ], [ 98.217912225169016, 19.155523586144596 ], [ 98.213674758183572, 19.160639553172842 ], [ 98.211039259853919, 19.162706610721528 ], [ 98.207783644799349, 19.164101873802423 ], [ 98.203907912120428, 19.164799505792558 ], [ 98.190575392640199, 19.164566961795884 ], [ 98.186389601598876, 19.163946845070797 ], [ 98.18297895691336, 19.162551581090526 ], [ 98.179878370590359, 19.160846258747824 ], [ 98.172902053387077, 19.153947455011007 ], [ 98.169956495795645, 19.152164618302521 ], [ 98.166029087172603, 19.151337795103103 ], [ 98.161998325762113, 19.150872708009018 ], [ 98.158587681076654, 19.149658311182094 ], [ 98.156107212377947, 19.145214137722292 ], [ 98.15285159732332, 19.124956976982872 ], [ 98.149699335056312, 19.112813015008612 ], [ 98.147735630295131, 19.109376531901489 ], [ 98.144790073602962, 19.105836696906039 ], [ 98.140087517724737, 19.101754259551399 ], [ 98.12711673434984, 19.093305162203478 ], [ 98.121690708059759, 19.08891266468774 ], [ 98.119675328253777, 19.086509711254166 ], [ 98.118435093005075, 19.082969876258716 ], [ 98.118590121736702, 19.07860321716467 ], [ 98.132077670847764, 19.050232855861537 ], [ 98.132387730109599, 19.046124579185971 ], [ 98.131922642116251, 19.041602892259675 ], [ 98.10990848219069, 19.001837876916483 ], [ 98.109288364566396, 19.000442612936212 ], [ 98.108358188579473, 18.997083645094108 ], [ 98.108461542266355, 18.99212270769678 ], [ 98.10970177571636, 18.985198066437647 ], [ 98.119520297723511, 18.961013495276546 ], [ 98.122775912778195, 18.950187282916801 ], [ 98.123551060033378, 18.945148831153602 ], [ 98.123706088764948, 18.93858592420105 ], [ 98.121225620965674, 18.921015936836028 ], [ 98.11218224531433, 18.890991930033522 ], [ 98.083501824749362, 18.830427150692486 ], [ 98.083656854380365, 18.823605862220745 ], [ 98.085362176723095, 18.813787340213565 ], [ 98.095594109880267, 18.7832724060967 ], [ 98.098849724934894, 18.776993719984148 ], [ 98.101330193633487, 18.774978339278903 ], [ 98.10494754389407, 18.77425486886716 ], [ 98.112388950889397, 18.775210883275662 ], [ 98.116264682668998, 18.774978339278903 ], [ 98.119003533786099, 18.773479723410532 ], [ 98.120605503341324, 18.76973318104146 ], [ 98.120915561703782, 18.764849758009916 ], [ 98.119365268991942, 18.756038927254707 ], [ 98.115489537212341, 18.747202257178401 ], [ 98.113732538026227, 18.744230862064626 ], [ 98.10990848219069, 18.733921414541584 ], [ 98.108668246942045, 18.725808213977842 ], [ 98.108151483004519, 18.71728160226408 ], [ 98.108668246942045, 18.70485342034911 ], [ 98.108358188579473, 18.700796821416162 ], [ 98.108358188579473, 18.685888169903109 ], [ 98.110218539653829, 18.669687608096638 ], [ 98.110321893340711, 18.661574408432188 ], [ 98.109391718253164, 18.656070867776265 ], [ 98.107531366279545, 18.653280340715128 ], [ 98.103087192819658, 18.648061020899405 ], [ 98.101226840845982, 18.645115465106613 ], [ 98.099779900921703, 18.641859850052015 ], [ 98.099934929653216, 18.63710561822964 ], [ 98.101640252895322, 18.631524563208046 ], [ 98.106291131930163, 18.623127142703481 ], [ 98.114249301963753, 18.612352607187091 ], [ 98.116109653937372, 18.606797389687728 ], [ 98.117504917018266, 18.598348294138503 ], [ 98.117970005011671, 18.564448553757813 ], [ 98.116264682668998, 18.556877957351873 ], [ 98.11393924360118, 18.549979152715679 ], [ 98.113732538026227, 18.545354112102615 ], [ 98.115489537212341, 18.539798896401919 ], [ 98.130372349404354, 18.518068956417181 ], [ 98.157967564351566, 18.485176907288377 ], [ 98.160654737725963, 18.483135688161497 ], [ 98.167269322421248, 18.479983424995083 ], [ 98.171196731044233, 18.478820705910863 ], [ 98.175072462823834, 18.478045559554886 ], [ 98.182203810557439, 18.475565089956973 ], [ 98.18530439688044, 18.474040636566087 ], [ 98.196621534756048, 18.46626333278661 ], [ 98.202512649039477, 18.463136908041918 ], [ 98.208093703161808, 18.45908030910897 ], [ 98.209488967142136, 18.4558505315768 ], [ 98.209488967142136, 18.451587226169522 ], [ 98.206388380819078, 18.444998480795249 ], [ 98.202977736133562, 18.441510321743948 ], [ 98.199567092347422, 18.439029853045241 ], [ 98.195846389299447, 18.437944648326805 ], [ 98.191815626989637, 18.437531236277493 ], [ 98.18778486467977, 18.437944648326805 ], [ 98.184219191262628, 18.439029853045241 ], [ 98.178018020415323, 18.441846218528212 ], [ 98.174762403562056, 18.44189789537154 ], [ 98.171920200556826, 18.440605984178859 ], [ 98.16964643833245, 18.438461412264388 ], [ 98.167786086358831, 18.435800076412335 ], [ 98.165098912085057, 18.428694566201301 ], [ 98.162618443386464, 18.417222397795371 ], [ 98.160034621000989, 18.410504462111277 ], [ 98.153471714048351, 18.398722236242207 ], [ 98.149285923006914, 18.393554592370521 ], [ 98.107221307017653, 18.359913235307516 ], [ 98.10494754389407, 18.357406928187203 ], [ 98.103087192819658, 18.354848945122711 ], [ 98.101330193633487, 18.351955064374692 ], [ 98.100089960183482, 18.348544419689176 ], [ 98.099779900921703, 18.344823717540493 ], [ 98.099934929653216, 18.340327867237249 ], [ 98.100555048176886, 18.335521959470839 ], [ 98.102157016832905, 18.329475816455698 ], [ 98.104327427168982, 18.324669907789996 ], [ 98.109288364566396, 18.320070706497916 ], [ 98.116884800293235, 18.315807400191375 ], [ 98.118745152266968, 18.312939357865076 ], [ 98.119210240260315, 18.308831082088773 ], [ 98.117143181812366, 18.302552395076958 ], [ 98.110942010065685, 18.292217109132281 ], [ 98.105360955943297, 18.279530544798831 ], [ 98.091873406832292, 18.236742459297062 ], [ 98.092183466094127, 18.232556668255654 ], [ 98.094198845899996, 18.227905789220785 ], [ 98.103500603969678, 18.219094957566199 ], [ 98.106291131930163, 18.21390147527282 ], [ 98.108048130217071, 18.207157701167006 ], [ 98.10970177571636, 18.193773504843421 ], [ 98.109598422928855, 18.171268419401969 ], [ 98.10897830620388, 18.16731517235732 ], [ 98.105050896681576, 18.152535712053464 ], [ 98.106187779142715, 18.146360377829211 ], [ 98.109598422928855, 18.137859605436461 ], [ 98.122155796053107, 18.119178574931283 ], [ 98.125101352745276, 18.113054918449734 ], [ 98.126651646356379, 18.107215481009661 ], [ 98.127271763081353, 18.096595974224897 ], [ 98.126651646356379, 18.090730699262366 ], [ 98.12479129438276, 18.086699936952584 ], [ 98.122000767321595, 18.084529527515684 ], [ 98.112078891627561, 18.080447089261753 ], [ 98.105981072668385, 18.076778062157842 ], [ 98.103500603969678, 18.07460765182168 ], [ 98.099159784196615, 18.069620876901922 ], [ 98.095749138611893, 18.063807277883541 ], [ 98.094302198687501, 18.060603338773092 ], [ 98.089392938133585, 18.037503974129095 ], [ 98.088101026940819, 18.034222519753484 ], [ 98.084742059098687, 18.02812470079428 ], [ 98.083501824749362, 18.02471405700814 ], [ 98.083191766386904, 18.02006317797327 ], [ 98.083656854380365, 18.014818019735827 ], [ 98.087170851853273, 17.997480577266771 ], [ 98.093888788436857, 17.979238796333419 ], [ 98.09771284427228, 17.973218491739999 ], [ 98.102467076094626, 17.96763743671832 ], [ 98.122620884046569, 17.949602363158505 ], [ 98.153161655685892, 17.932807522149375 ], [ 98.156262242008836, 17.930430406238258 ], [ 98.181118605839004, 17.899837957755608 ], [ 98.186079543236303, 17.895109565254245 ], [ 98.20747358643689, 17.868651230969505 ], [ 98.214294874908489, 17.8628376328505 ], [ 98.219875929930254, 17.859297796955701 ], [ 98.223596632978229, 17.858083401028154 ], [ 98.227369011970325, 17.855887153169647 ], [ 98.231089715917676, 17.852321478853128 ], [ 98.235895623684087, 17.846533718256467 ], [ 98.240236444356412, 17.839583238575585 ], [ 98.242871941786689, 17.833537096459821 ], [ 98.243337029780037, 17.82488129353689 ], [ 98.24158003059398, 17.820669664073733 ], [ 98.239151238738714, 17.817620753694825 ], [ 98.236205682046545, 17.8159671090948 ], [ 98.228299187957134, 17.809998481344905 ], [ 98.22597374888943, 17.807595527011955 ], [ 98.224526808965038, 17.803590603123894 ], [ 98.224216749703203, 17.798242092098889 ], [ 98.225353632164342, 17.789973862803521 ], [ 98.222976516253198, 17.786718247748922 ], [ 98.219875929930254, 17.784702867043649 ], [ 98.216051874094717, 17.783721015112775 ], [ 98.213364698921737, 17.781628119142397 ], [ 98.211969435840786, 17.778501695296967 ], [ 98.213054640559221, 17.772868964331224 ], [ 98.216671990819691, 17.76529836702602 ], [ 98.226697219301172, 17.751319892399124 ], [ 98.233260126253811, 17.7373672552946 ], [ 98.233518507772885, 17.728711453270932 ], [ 98.245920852165568, 17.718195299273646 ], [ 98.302609897928448, 17.69589691850797 ], [ 98.249073114432633, 17.684915676517221 ], [ 98.243492059411039, 17.682874457390255 ], [ 98.237135858033355, 17.679748033544939 ], [ 98.226593865614348, 17.672668361755484 ], [ 98.217292108443985, 17.664916897297019 ], [ 98.20685346881254, 17.65155853939504 ], [ 98.202047561046129, 17.646778469150973 ], [ 98.198171828367151, 17.645150662073405 ], [ 98.193210890969794, 17.643987942089808 ], [ 98.164685500035773, 17.646597601997712 ], [ 98.128356967799789, 17.646080837160838 ], [ 98.119003533786099, 17.643677882828001 ], [ 98.105050896681576, 17.638639431064888 ], [ 97.996427036978218, 17.587944851473736 ], [ 97.981234164624937, 17.577506211842234 ], [ 97.979373813550694, 17.574870714411986 ], [ 97.966971470057331, 17.570788276158027 ], [ 97.92397667808126, 17.568953761706751 ], [ 97.908060337114875, 17.554923611135735 ], [ 97.907994430149415, 17.554865514016171 ], [ 97.76894657400004, 17.679180399000046 ], [ 97.759334758000136, 17.691479391000087 ], [ 97.753133586000047, 17.705380351000059 ], [ 97.751789999000096, 17.718092753000121 ], [ 97.751583293000124, 17.729564922000037 ], [ 97.749619588000087, 17.739848532000025 ], [ 97.741041301000052, 17.750183818000039 ], [ 97.716856731000121, 17.769769186000076 ], [ 97.711172323000085, 17.781293030000086 ], [ 97.706521444000089, 17.794728902000145 ], [ 97.696496216000071, 17.806562806000073 ], [ 97.683990520000066, 17.816536357000075 ], [ 97.676135702000124, 17.830333964000118 ], [ 97.699080038000091, 17.833331198000025 ], [ 97.685540813000102, 17.880718486000092 ], [ 97.691845337000075, 17.895601298000145 ], [ 97.720060669000077, 17.943195293000088 ], [ 97.747552531000053, 17.960920309000102 ], [ 97.750859823000042, 17.963659160000049 ], [ 97.754063762000101, 17.969033508000109 ], [ 97.751789999000096, 17.980764058000091 ], [ 97.747242473000085, 17.99249460900009 ], [ 97.744038533000094, 17.997817282000113 ], [ 97.739801066000041, 18.002933248000119 ], [ 97.725228313000059, 18.036755473000113 ], [ 97.72212772600011, 18.048925273000094 ], [ 97.720060669000077, 18.053059387000133 ], [ 97.706418091000046, 18.05928639800004 ], [ 97.702180624000107, 18.061844381000128 ], [ 97.697736450000093, 18.060733338000119 ], [ 97.694222453000123, 18.061508484000029 ], [ 97.692775513000129, 18.070112610000081 ], [ 97.693705689000126, 18.075125224000118 ], [ 97.698046509000108, 18.08465952500012 ], [ 97.699080038000091, 18.090653992000057 ], [ 97.696806274000039, 18.101583558000101 ], [ 97.687504516000104, 18.119825338000084 ], [ 97.685334107000131, 18.131607564000063 ], [ 97.685334107000131, 18.140160014000088 ], [ 97.684300578000034, 18.146102804000122 ], [ 97.680373170000109, 18.152639872000094 ], [ 97.629006796000112, 18.220852763000039 ], [ 97.617948039000112, 18.24167836500007 ], [ 97.620738566000057, 18.251083476000133 ], [ 97.635724732000085, 18.257594707000095 ], [ 97.643269491000126, 18.273020121000087 ], [ 97.643786255000123, 18.291313578000057 ], [ 97.63758508300009, 18.306325582000056 ], [ 97.624665975000028, 18.31340525300007 ], [ 97.573816366000131, 18.333093974000121 ], [ 97.562447551000048, 18.33051015300012 ], [ 97.560587199000054, 18.32826222700001 ], [ 97.541983684000058, 18.280228983000057 ], [ 97.537642863000087, 18.272580872000077 ], [ 97.528341105000095, 18.265320333000091 ], [ 97.508083944000077, 18.276559957000075 ], [ 97.486483195000119, 18.292140401000097 ], [ 97.466536092000069, 18.311441549000051 ], [ 97.45258345600007, 18.333610738000061 ], [ 97.446795695000105, 18.358312073000064 ], [ 97.446485637000137, 18.381178894000072 ], [ 97.443074992000106, 18.4033480840001 ], [ 97.417650188000096, 18.441149394000092 ], [ 97.39460249900003, 18.487089742000052 ], [ 97.39046838400003, 18.501817525000064 ], [ 97.379099569000118, 18.520782776000118 ], [ 97.357602173000089, 18.539903056000099 ], [ 97.351401001000113, 18.551168519000072 ], [ 97.372898830008523, 18.548616617881379 ], [ 97.380133098000101, 18.547757874000041 ], [ 97.388918091000107, 18.542228496000035 ], [ 97.40938195800004, 18.511351827000055 ], [ 97.412172485000099, 18.503031921000087 ], [ 97.416616659000113, 18.496029765000088 ], [ 97.427468710000085, 18.48951853500003 ], [ 97.438114055000085, 18.488123271000035 ], [ 97.46281538900007, 18.492464091000016 ], [ 97.509530884000071, 18.491275533000106 ], [ 97.54839156100013, 18.50907806400005 ], [ 97.617948039000112, 18.553158061000119 ], [ 97.637378378000108, 18.559281718000079 ], [ 97.690295044000095, 18.557886454000084 ], [ 97.737940714000104, 18.570495504000121 ], [ 97.742798299000128, 18.569255270000099 ], [ 97.745692180000049, 18.571063945000077 ], [ 97.751789999000096, 18.58248443700009 ], [ 97.759748169000034, 18.62279205400003 ], [ 97.752616821000117, 18.663435567000079 ], [ 97.741248006000035, 18.703148906000081 ], [ 97.73628706900007, 18.740588481000145 ], [ 97.735770305000131, 18.762654318000045 ], [ 97.732669719000114, 18.780508525000073 ], [ 97.720370728000034, 18.817638041000066 ], [ 97.719440552000094, 18.825880432000105 ], [ 97.723367961000065, 18.851977030000114 ], [ 97.719130494000126, 18.864637756000036 ], [ 97.708588501000065, 18.875205587000011 ], [ 97.684403931000077, 18.892491353000111 ], [ 97.661873006000064, 18.913782044000101 ], [ 97.65784224500004, 18.925719299000036 ], [ 97.66807417800004, 18.935434469000086 ], [ 97.68905481000013, 18.949748841000059 ], [ 97.70331750500003, 18.964373271000056 ], [ 97.710448853000059, 18.979902039000052 ], [ 97.716960083000117, 19.018323466000112 ], [ 97.727812134000089, 19.037082011000109 ], [ 97.789927205000083, 19.082583109000069 ], [ 97.8040865480001, 19.097956848000138 ], [ 97.810804485000119, 19.112219543 ], [ 97.815145304000112, 19.1905610150001 ], [ 97.812561483000081, 19.208466899000058 ], [ 97.805223430000126, 19.227354635000097 ], [ 97.796335083000088, 19.236682231000117 ], [ 97.769670045000055, 19.257275289000034 ], [ 97.764088990000118, 19.266396179000111 ], [ 97.7680163980001, 19.277119040000116 ], [ 97.777318156000035, 19.278617655000033 ], [ 97.788686971000118, 19.277739156000081 ], [ 97.798298787000135, 19.281408183000082 ], [ 97.806153606000066, 19.301096903000115 ], [ 97.797058553000113, 19.318382671000023 ], [ 97.783105917000114, 19.337089539000118 ], [ 97.776698039000053, 19.361093242000038 ], [ 97.77514774600013, 19.37106679300004 ], [ 97.767706340000132, 19.390367941000079 ], [ 97.767086222000046, 19.397525126000033 ], [ 97.800365845000101, 19.44077830000009 ], [ 97.833542115000114, 19.468709412000067 ], [ 97.842120403000138, 19.479380595000066 ], [ 97.848734985000135, 19.493979187000036 ], [ 97.848114869000085, 19.499560242000058 ], [ 97.8442908130001, 19.504521180000012 ], [ 97.840983521000112, 19.517156067000144 ], [ 97.838916463000089, 19.537103170000051 ], [ 97.839846639000029, 19.55531911300011 ], [ 97.848631633000082, 19.567643942000046 ], [ 97.869123020955442, 19.570489967968911 ], [ 97.885838664000119, 19.572811585000068 ], [ 97.948057089000031, 19.602422181000094 ], [ 97.956118612000125, 19.609372660000105 ], [ 97.970691366000096, 19.625934957000084 ], [ 97.979476360000035, 19.633324686 ], [ 97.990431763000117, 19.636554464000085 ], [ 98.000146932000064, 19.636296082000115 ], [ 98.008311809000077, 19.639112447000088 ], [ 98.013582805000112, 19.65174733500001 ], [ 98.013892863000081, 19.669446513000111 ], [ 98.005624634000071, 19.705645854000068 ], [ 98.004591105000088, 19.72391347300001 ], [ 98.017923624000105, 19.789387513000094 ], [ 98.024538208000081, 19.802978414000108 ], [ 98.04562219200011, 19.807629293000076 ], [ 98.060608358000081, 19.793909200000115 ], [ 98.072907349000047, 19.77729522700011 ], [ 98.085929810000096, 19.773161112000082 ] ] ] }

    }];

        L.geoJSON(states, {
            style: function(feature) {
                switch (feature.properties.party) {
                    case 'Republican': return {color: "#ff0000"};
                    case 'Democrat':   return {color: "#0000ff"};
                }
            },
            onEachFeature: onEachFeature
        }).addTo(map);

        function onEachFeature(feature, layer) {
            layer.on({

                click: zoomToFeature
            });
        }

        function zoomToFeature(e) {
            map.flyToBounds(e.target.getBounds());
        }


        map.on("zoom", reset);
        reset();

            // This function runs on zoom. It needs to redraw the path and dots and set the svg sizes
            function reset() {
                console.log("Starting reset");
                var bounds = path.bounds(mapData),
                    topLeft = bounds[0],
                    bottomRight = bounds[1];

                svg.attr("width", 10000)
                    .attr("height", 10000)
                    .attr("width", bottomRight[0] - topLeft[0])
                    .attr("height", bottomRight[1] - topLeft[1])
                    .style("left", topLeft[0] + "px")
                    .style("top", topLeft[1] + "px")
                    .attr("d", function (d) {
                        return path(d)
                    })
                    .attr("stroke-width", 2)
                    .attr("stroke", "blue")
                    .attr("fill", "transparent");

                // THIS IS THE STYLE FOR THE CIRCLE LAYER
                svg1.style("left", topLeft[0] + "px")
                    .style("top", topLeft[1] + "px");

                g.attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");

                g1.attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")");

                //svg1.attr("transform", "translate(" + -topLeft[0] + "," + -topLeft[1] + ")")

                feature.attr("d", path)
                    .on("mouseover", function(d) {
                        d3.select(this).style("fill", d => "blue");
                    })
                    .on("mouseout", function(d) {
                        d3.select(this).style("fill", d => "transparent");
                    })
                    .on("click", function(d) {
                        //console.log("STINKY");
                        map.flyToBounds(path.bounds(d), {
                            //paddingTopLeft: [200, 300],
                            'animate': true,
                            'duration': 2
                        });

                    });

                const allCircles = document.querySelectorAll(".inner-CL > circle");
                for(i = 0; i < coordinates.length; i++) {
                            allCircles[i].setAttribute("cx", map.latLngToLayerPoint(new L.LatLng(coordinates[i].latitude, coordinates[i].longitude)).x);
                            allCircles[i].setAttribute("cy", map.latLngToLayerPoint(new L.LatLng(coordinates[i].latitude, coordinates[i].longitude)).y);
                }
            }


            function projectPoint(x, y) {
                var point = map.latLngToLayerPoint(new L.LatLng(y, x));
                this.stream.point(point.x, point.y);
            }



        }





function createMap(mapData, coordinates) {

    console.log("Checkpoint 6");

    console.log(mapData)
    console.log(coordinates)

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    var g = svg.append('g');
    var mapLayer = g.append('g')
        .classed('map-layer', true);

    var circleLayer = g.append('g')
        .classed('circle-layer', true);

    let proj = d3.geoMercator()
        .translate([250, 250])
        .scale(2000)
        .rotate([-100.6331, -13.2])

    let path = d3.geoPath()
        .projection(proj)

    mapLayer.selectAll("path")
        .data(mapData.features)
        .enter()
        .append("path")
            .attr("d", function(d) { return path(d) })
            .attr("stroke-width", 2)
            .attr("stroke", "#ffffff")
            .attr("fill", d => "blue");


    //THIS PUTS THE DOTS ON THE MAP
     circleLayer.selectAll("circle")
         .data(coordinates)
         .enter()
         .append("circle")
             .attr("r", 3)
             .attr("cx", d => proj([+d.longitude, +d.latitude])[0])
             .attr("cy", d => proj([+d.longitude, +d.latitude])[1])
             .attr("stroke-width", 1)
             .attr("stroke", "#4F442B")
             .attr("fill", function() { return "#FFD061" });



//    d3.csv("coordinates.csv", function(fireData) {
//        console.log(fireData)
//        console.log(proj([mapData.latitude, mapData.longitude]))
//        console.log(proj([fireData[0].latitude, fireData[0].longitude]))
//        mapLayer.selectAll("path")
//            .data(fireData)
//            .enter()
//            .append("circle")
//                .attr("r", 3)
//                .attr("cx", d => proj([d.latitude, d.longitude])[0])
//                .attr("cy", d => proj([d.latitude, d.longitude])[1])
//                .attr("stroke-width", 1)
//                .attr("stroke", "#4F442B")
//                .attr("fill", function() { return "#FFD061" });
//    });

    // d3.select("svg")
    //     .selectAll("path")
    //     .data(mapData.features)
    //     .enter()
    //     .append("path")
    //         .attr("d", path)
    //         .attr("d", function(d) { return path(d) })
    //         .attr("stroke-width", 1)
    //         .attr("stroke", "#ffffff")
    //         .style("fill", function() { return "#FFD061" });

}




</script>

</body>
</html>
